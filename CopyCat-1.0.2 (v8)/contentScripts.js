if(!window.copyCatCSInjected){const e=chrome.runtime.connect({name:"content_script_port"});window.addEventListener("error",(t=>{e.postMessage({action:"error_in_content_script",errorMessage:t?.message||"Error in content script"})})),window.addEventListener("unhandledrejection",(t=>{e.postMessage({action:"error_in_content_script",errorMessage:t?.reason?.message||"Error in content script"})}));const t=e=>{const t=e=>Array.from(e).reduce(((e,t)=>(["id","data-","role","class","name","type","href","src","aria-"].includes(t.name)&&(e[t.name]=t.value),e)),{}),n=e.parentElement,o=Array.from(n?.children||[]),a=e.getBoundingClientRect();let s=a.left+a.width/2+window.scrollX,r=a.top+a.height/2+window.scrollY,i=window,c=null;for(;i!==window.top;){c=i.frameElement;const e=c.getBoundingClientRect();s+=e.left+i.scrollX,r+=e.top+i.scrollY,i=i.parent}s*=window.devicePixelRatio,r*=window.devicePixelRatio;const d={x:s,y:r};return{tagName:e.tagName,attributes:t(e.attributes),textContent:e.textContent?e.textContent.trim():"",coordinates:d,parent:n?{tagName:n.tagName,attributes:t(n.attributes),textContent:n.textContent?n.textContent.trim():""}:null,siblings:o.map((e=>({tagName:e.tagName,attributes:t(e.attributes),textContent:e.textContent.trim()})))}},n=async n=>{if(0!==n.button)return;const o=n.target;if(!o)return;const a=o.getBoundingClientRect(),s=t(o),r=Date.now(),i={type:"mouse_click",details:{serializedElement:s,screenshotCoordinates:{x:s.coordinates.x,y:s.coordinates.y,width:a.width,height:a.height}},timestamp:r};await e.postMessage({action:"event_captured",eventCaptured:i})},o=async n=>{if(0!==n.button)return;const o=n.target;if(!o)return;const a=o.getBoundingClientRect(),s=t(o),r={serializedElement:s,screenshotCoordinates:{x:s.coordinates.x,y:s.coordinates.y,width:a.width,height:a.height}};await e.postMessage({action:"listener_mouse_click_captured",eventCaptured:r})},a=()=>{document.addEventListener("mousedown",n,{capture:!0})},s=()=>{document.removeEventListener("mousedown",n,{capture:!0})},r=()=>{document.addEventListener("mousedown",o,{capture:!0})},i=()=>{document.removeEventListener("mousedown",o,{capture:!0})},c=async t=>{if("key"in t==!1)return;if("Enter"===t.key){const t={type:"enter_pressed",details:{},timestamp:Date.now()};return void await e.postMessage({action:"event_captured",eventCaptured:t})}if("Backspace"===t.key){const t={type:"backspace_pressed",details:{},timestamp:Date.now()};return void await e.postMessage({action:"event_captured",eventCaptured:t})}if(t.key.length>1)return;const n=Date.now(),o={type:"text_typed",details:{text:t.key},timestamp:n};await e.postMessage({action:"event_captured",eventCaptured:o})},d=()=>{document.addEventListener("keyup",c,{capture:!0})},u=()=>{document.removeEventListener("keyup",c,{capture:!0})},p=async n=>{const o=n.target;if(!o)return;const a=o.getBoundingClientRect(),s=t(o),r=Date.now(),i={type:"copy",details:{serializedElement:t(o),screenshotCoordinates:{x:s.coordinates.x,y:s.coordinates.y,width:a.width,height:a.height}},timestamp:r};await e.postMessage({action:"event_captured",eventCaptured:i})},m=async n=>{const o=n.target;if(!o)return;const a=o.getBoundingClientRect(),s=t(o),r={serializedElement:s,screenshotCoordinates:{x:s.coordinates.x,y:s.coordinates.y,width:a.width,height:a.height}};await e.postMessage({action:"listener_copy_captured",eventCaptured:r})},l=()=>{document.addEventListener("copy",p,{capture:!0})},g=()=>{document.removeEventListener("copy",p,{capture:!0})},w=()=>{document.addEventListener("copy",m,{capture:!0})},h=()=>{document.removeEventListener("copy",m,{capture:!0})},y=async n=>{const o=n.target;if(!o)return;const a=o.getBoundingClientRect(),s=t(o),r=Date.now(),i={type:"paste",details:{serializedElement:t(o),screenshotCoordinates:{x:s.coordinates.x,y:s.coordinates.y,width:a.width,height:a.height}},timestamp:r};await e.postMessage({action:"event_captured",eventCaptured:i})},v=async n=>{const o=n.target;if(!o)return;const a=o.getBoundingClientRect(),s=t(o),r={serializedElement:s,screenshotCoordinates:{x:s.coordinates.x,y:s.coordinates.y,width:a.width,height:a.height}};await e.postMessage({action:"listener_paste_captured",eventCaptured:r})},_=()=>{document.addEventListener("paste",y,{capture:!0})},C=()=>{document.removeEventListener("paste",y,{capture:!0})},f=()=>{document.addEventListener("paste",v,{capture:!0})},E=()=>{document.removeEventListener("paste",v,{capture:!0})};let x;(()=>{x||(x=new MutationObserver((t=>{const n=t=>{t.addEventListener("load",(async()=>{const n=t.src;e.postMessage({action:"new_iframe_added",frameSrc:n})}))};for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)if(t.nodeType===Node.ELEMENT_NODE){"IFRAME"===t.tagName&&n(t);const e=t.querySelectorAll?t.querySelectorAll("iframe"):[];for(const t of e)n(t)}})),x.observe(document.body,{childList:!0,subtree:!0}))})(),chrome.runtime.onMessage.addListener((async(e,t,n)=>("start_recording"===e.action?(a(),d(),l(),_(),n({status:"ok"})):"stop_recording"===e.action?(s(),u(),g(),C(),n({status:"ok"})):"listen_for_mouse_click"===e.action?(r(),n({status:"ok"})):"listen_for_copy"===e.action?(w(),n({status:"ok"})):"listen_for_paste"===e.action?(f(),n({status:"ok"})):"remove_active_listeners"===e.action&&(i(),h(),E(),n({status:"ok"})),!0))),window.copyCatCSInjected=!0}